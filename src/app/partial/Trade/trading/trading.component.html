<div class="main-container p-4">
    <h2 class="text-xl font-bold mb-4">Stock Orders</h2>
    <div class="nav">
        <button class="custom-btn-add bg-blue-600 text-white px-3 py-2 rounded" (click)="onChangeTab('orderList')">Order
            List</button>
        <button class="custom-btn-add bg-blue-600 text-white px-3 py-2 rounded"
            (click)="onChangeTab('summary')">Summary</button>
    </div>
    <div *ngIf="isOrderList" class="btn-add">
        <button *ngIf="!isAdd" class="custom-btn-add bg-blue-600 text-white px-3 py-2 rounded"
            (click)="onAddNewOrder()">Add
            New Order</button>
    </div>
    <div *ngIf="!isOrderList" class="btn-hd">
    </div>
    <div *ngIf="isAdd" class="container-add">
        <!-- /// -->
        <table class="border-collapse tb-add">
            <tr class="bg-gray-200">
                <th class="border p-2 asterisk">Type</th>
                <th class="border p-2 asterisk">Stock Code</th>
                <th class="border p-2 asterisk">Quantity</th>
                <th class="border p-2 asterisk">Buy Price</th>
                <th *ngIf="orderBody['order_type'] == 'SELL'" class="border p-2 asterisk">Sell Price</th>
                <th class="border p-2 asterisk">Total Amount</th>
                <th class="border p-2 asterisk">Time</th>
                <th class="border p-2">Description</th>
            </tr>
            <tr class="tr_summary">
                <!-- ORDER TYEPE -->
                <td><select [value]="orderBody['order_type']" (change)="onChangeValue($event, 'order_type')" name="type"
                        class="border p-2 rounded">
                        <option value="BUY">BUY</option>
                        <option value="SELL">SELL</option>
                    </select></td>
                <!-- STOCK CODE -->
                <td><input [value]="orderBody['stock_code']" name="stock" placeholder="Stock Code"
                        (change)="onChangeValue($event, 'stock_code')" class="border p-2 rounded" /></td>
                <!-- QUANTITY -->
                <td><input [value]="parseInt(orderBody['quantity']) | number"
                        (change)="onChangeValue($event, 'quantity')" name="qty" placeholder="Qty" type="text"
                        class="border p-2 rounded" /></td>
                <!-- digitAddCommas [fractions]="0" [tmComponent]="true" -->
                <!-- PRICE BUY -->
                <td *ngIf="orderBody['order_type'] == 'BUY'"> <input [value]="parseInt(orderBody['price_buy']) | number"
                        (change)="onChangeValue($event, 'price_buy')" name="price_buy" placeholder="Price" type="text"
                        class="border p-2 rounded" /></td>
                <!-- AVERAGE PRICE FOR ADD SELL -->
                <td *ngIf="orderBody['order_type'] == 'SELL'"> <input [value]="populateAveragePriceOrder() | number"
                        name="price_buy_in_sell" placeholder="Price" type="text" disabled class="border p-2 rounded" />
                </td>
                <!-- PRICE SELL -->
                <td *ngIf="orderBody['order_type'] == 'SELL'"> <input
                        [value]="parseInt(orderBody['price_sell'])| number"
                        (change)="onChangeValue($event, 'price_sell')" name="price_sell" placeholder="Price" type="text"
                        class="border p-2 rounded" /></td>
                <!-- TOTAL AMOUNT -->
                <td><input [value]="totalAmount() | number" name="total_amount" placeholder="Total Amount" type="text"
                        disabled class="border p-2 rounded" /></td>
                <!-- ISSUE DATE -->
                <td><input [value]="orderBody['created_at']" (change)="onChangeValue($event, 'created_at')" type="date"
                        placeholder="Created Date" name="date" class="border p-2 rounded" /></td>
                <!-- DESCRIPTION -->
                <td style="width: 16%;"><input [value]="orderBody['description']"
                        (change)="onChangeValue($event, 'description')" type="text" placeholder="Description"
                        name="description" class="border p-2 rounded" /></td>
            </tr>
        </table>
        <!-- /// -->
        <div class="btn-save">
            <button (click)="addCall('orders')"
                class="custom-btn bg-blue-600 text-white px-3 py-2 rounded">Save</button>
        </div>
        <div class="btn-close">
            <button class="custom-btn bg-blue-600 text-white px-3 py-2 rounded" (click)="onClose()">Close</button>
        </div>
    </div>

    <table *ngIf="isOrderList" class="border-collapse w-full">
        <tr class="bg-gray-200">
            <th class="border p-2">Stock Code</th>
            <th class="border p-2">Type</th>
            <th class="border p-2">Quantity</th>
            <th class="border p-2">Buy Price</th>
            <th class="border p-2">Sell Price</th>
            <th class="border p-2">Total Amount</th>
            <th class="border p-2">Time</th>
            <th class="border p-2">Description</th>
        </tr>
        <tr class="font-order" *ngFor="let o of orders">
            <td class="border p-2">{{o.stock_code}}</td>
            <td class="border p-2">{{o.order_type}}</td>
            <td class="border p-2">{{parseInt(o.quantity) | number}}</td>
            <td class="border p-2">{{parseInt(o.price_buy) | number}}</td>
            <td class="border p-2">{{parseInt(o.price_sell) | number}}</td>
            <td class="border p-2">{{o.total_amount | number}}</td>
            <!-- | date: 'dd/MM/yyyy HH:mm a' -->
            <td class="border p-2">{{o.created_at | date: 'dd/MM/yyyy'}}</td>
            <td class="border p-2">{{o.description}}</td>
            <td class="btn-mdf">
                <button class="mdf custom-btn bg-blue-600 text-white px-3 py-2 rounded"
                    (click)="deleteCall(o.id, 'orders')">Delete</button>
                <button (click)="openPopup(o)"
                    class="mdf custom-btn bg-blue-600 text-white px-3 py-2 rounded">Edit</button>
            </td>
        </tr>
    </table>
    <div class="summary-group">
        <table *ngIf="isSummary" class="border-collapse tab-summary">
            <tr class="bg-gray-200">
                <th class="border p-2">Stock Code</th>
                <th class="border p-2">Average Price</th>
                <th class="border p-2">Buy Quantity</th>
                <th class="border p-2">Buy Total Amount</th>
            </tr>
            <tr class="tr_summary" *ngFor="let o of summary">
                <td class="border p-2">{{o.stock_code}}</td>
                <td class="border p-2">{{parseInt(o.average_price) | number: '1.0-0'}}</td>
                <td class="border p-2">{{parseInt(o.total_buy_quantity) | number}}</td>
                <td class="border p-2">{{parseInt(o.total_buy_amount) | number}}</td>
                <!-- <td>{{15999.06367 | number: '1.0-0'}}</td> -->
            </tr>
        </table>
        <table *ngIf="isSummary" class="border-collapse tab-summary">
            <tr class="bg-gray-200">
                <th class="border p-2">Stock Code</th>
                <th class="border p-2">Real-time Price</th>
                <th class="border p-2">profits/lost</th>
            </tr>
            <tr class="tr_summary font-bold" *ngFor="let o of summary">
                <td class="border p-2">{{o.stock_code}}</td>
                <td class="border p-2">{{ showAveragePrice(o)| number: '1.0-0'}}</td>
                <td class="border p-2" [ngClass]="calculateProfitLost(o) > 0 ? 'price-up' : 'price-down'">
                    {{calculateProfitLost(o) | number}}</td>
                <!-- <td>{{15999.06367 | number: '1.0-0'}}</td> -->
            </tr>
        </table>
    </div>
    <div *ngIf="isSummary" class="total-lb" [ngClass]="totalProfitsLost() > 0? 'price-up': 'price-down'">
        <label>{{totalProfitsLost() > 0? 'Total Profits: ': 'Total Losts: '}}</label>
        <span>{{totalProfitsLost() | number}}</span>
    </div>
</div>
<!-- /////// -->
<div class="p-6 max-w-4xl mx-auto">
    <h2 class="text-2xl font-bold mb-4 text-center">üìà VNDirect Realtime + DChart</h2>

    <button (click)="refresh()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded mb-4">
        Refresh Data
    </button>

    <div *ngIf="stocks.length === 0" class="text-gray-500 text-center">
        Loading data...
    </div>

    <table *ngIf="stocks.length > 0" class="min-w-full border border-gray-300 rounded-md">
        <thead class="bg-gray-100 text-sm">
            <tr>
                <th class="p-2 text-left">M√£</th>
                <th class="p-2 text-right">Gi√° hi·ªán t·∫°i</th>
                <th class="p-2 text-right">Gi√° tham chi·∫øu</th>
                <th class="p-2 text-right">% Thay ƒë·ªïi</th>
                <th class="p-2 text-right">Gi√° m·ªü</th>
                <th class="p-2 text-right">Gi√° cao</th>
                <th class="p-2 text-right">Gi√° th·∫•p</th>
                <th class="p-2 text-right">Kh·ªëi l∆∞·ª£ng</th>
                <th class="p-2 text-right">C·∫≠p nh·∫≠t</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let s of stocks" class="border-t hover:bg-gray-50 transition tr_summary"
                [class.text-green-600]="s.change && s.change > 0" [class.text-red-600]="s.change && s.change < 0">
                <td class="p-2 font-bold" [ngClass]="checkColorPriceUpDown(s)">{{ s.code }}</td>
                <td class="p-2 text-right font-bold" [ngClass]="checkColorPriceUpDown(s) + animationUpDown(s)">{{ s.price || s.close*1000 |
                    number: '1.0-2' }}</td>
                <td class="p-2 text-right font-bold price-noChange">{{ s.reference*1000 | number: '1.0-2' }}</td>
                <td class="p-2 text-right font-bold" [ngClass]="checkColorPriceUpDown(s)">
                    {{ (((s.close - s.reference)/s.reference)*100 | number: '1.2-2') + '%' }}
                </td>
                <td class="p-2 text-right">{{ s.open*1000 | number: '1.0-2' }}</td>
                <td class="p-2 text-right">{{ s.high*1000 | number: '1.0-2' }}</td>
                <td class="p-2 text-right">{{ s.low*1000 | number: '1.0-2' }}</td>
                <td class="p-2 text-right">{{ s.volume | number }}</td>
                <td class="p-2 text-right text-xs text-gray-500">
                    {{ s.time ? (s.time | date: 'shortTime') : (s.date | date: 'short') }}
                </td>
            </tr>
        </tbody>
    </table>
</div>